<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ุฅุฏุงุฑุฉ ุงูุญุณุงุจ - ูุบุชูุง ุงูุฃู</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@900&display=swap" rel="stylesheet">
</head>
<body>
  <main>
    <h1>ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ</h1>
    <div id="userSection" style="display: none;">
      <p><strong>ุงูุจุฑูุฏ:</strong> <span id="userEmail"></span></p>
      <p><strong>ุงูุงุณู ุงูุญุงูู:</strong> <span id="userDisplayName"></span></p>
      <p><strong>ุงูุตูุฑุฉ ุงูุญุงููุฉ:</strong><br><img id="userPhoto" src="" alt="ุงูุตูุฑุฉ" width="100" /></p>

      <hr>

      <label>ุงูุงุณู ุงูุฌุฏูุฏ:</label>
      <input type="text" id="newName" placeholder="ุงูุชุจ ุงูุงุณู ุงูุฌุฏูุฏ" />
      <br>

      <label>ุฑุงุจุท ุงูุตูุฑุฉ ุงูุฌุฏูุฏุฉ:</label>
      <input type="text" id="newPhotoURL" placeholder="ุฑุงุจุท ุตูุฑุฉ ุฌุฏูุฏุฉ" />
      <br>

      <button onclick="updateProfileInfo()">ุชุญุฏูุซ ุงูุงุณู / ุงูุตูุฑุฉ</button>

      <hr>

      <label>ูููุฉ ุงูุณุฑ ุงูุฌุฏูุฏุฉ:</label>
      <input type="password" id="newPassword" placeholder="ูููุฉ ุงูุณุฑ ุงูุฌุฏูุฏุฉ" />
      <button onclick="changePassword()">ุชุบููุฑ ูููุฉ ุงูุณุฑ</button>

      <hr>

      <label>ูููุฉ ุงูุณุฑ ุงูุญุงููุฉ ูุชุฃููุฏ ุงูุญุฐู:</label>
      <input type="password" id="currentPassword" placeholder="ุฃุฏุฎู ูููุฉ ุงูุณุฑ" />
      <button style="color:red" onclick="deleteAccount()">โ ุญุฐู ุงูุญุณุงุจ ููุงุฆููุง</button>

      <p id="statusMsg" style="color: green;"></p>
    </div>
  </main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged,
    updateProfile,
    updatePassword,
    reauthenticateWithCredential,
    EmailAuthProvider,
    deleteUser
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC7CwNzF-4h4PY8nTOtxrCUHd3AzMZzPCw",
    authDomain: "lugatuna.firebaseapp.com",
    projectId: "lugatuna",
    storageBucket: "lugatuna.appspot.com",
    messagingSenderId: "411196040727",
    appId: "1:411196040727:web:6ed03e75abf31f3a9a70e7",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const userSection = document.getElementById("userSection");
  const userEmail = document.getElementById("userEmail");
  const userDisplayName = document.getElementById("userDisplayName");
  const userPhoto = document.getElementById("userPhoto");
  const statusMsg = document.getElementById("statusMsg");

  onAuthStateChanged(auth, (user) => {
    if (user) {
      userSection.style.display = "block";
      userEmail.textContent = user.email;
      userDisplayName.textContent = user.displayName || "ุบูุฑ ูุญุฏุฏ";
      userPhoto.src = user.photoURL || "";
    } else {
      // ๐ก๏ธ ุชุญููู ุงููุณุชุฎุฏู ุงูุบูุฑ ูุณุฌู ูุตูุญุฉ ุงูุฏุฎูู
      window.location.href = "login.html";
    }
  });

  // ุชุญุฏูุซ ุงูุงุณู ูุงูุตูุฑุฉ
  window.updateProfileInfo = () => {
    const user = auth.currentUser;
    const newName = document.getElementById("newName").value;
    const newPhotoURL = document.getElementById("newPhotoURL").value;

    updateProfile(user, {
      displayName: newName || user.displayName,
      photoURL: newPhotoURL || user.photoURL
    }).then(() => {
      statusMsg.textContent = "โ ุชู ุงูุชุญุฏูุซ ุจูุฌุงุญ.";
      location.reload(); // ุฅุนุงุฏุฉ ุชุญููู ูุชุญุฏูุซ ุงููุนูููุงุช
    }).catch((error) => {
      statusMsg.textContent = "โ ุฎุทุฃ ูู ุงูุชุญุฏูุซ: " + error.message;
    });
  };

  // ุชุบููุฑ ูููุฉ ุงูุณุฑ
  window.changePassword = () => {
    const user = auth.currentUser;
    const newPassword = document.getElementById("newPassword").value;

    if (newPassword.length < 6) return alert("ูููุฉ ุงูุณุฑ ูุฌุจ ุฃู ุชููู 6 ุฃุญุฑู ุนูู ุงูุฃูู.");

    updatePassword(user, newPassword).then(() => {
      statusMsg.textContent = "โ ุชู ุชุบููุฑ ูููุฉ ุงูุณุฑ ุจูุฌุงุญ.";
    }).catch((error) => {
      statusMsg.textContent = "โ ูุดู ุชุบููุฑ ูููุฉ ุงูุณุฑ: " + error.message;
    });
  };

  // ุญุฐู ุงูุญุณุงุจ
  window.deleteAccount = () => {
    const user = auth.currentUser;
    const password = document.getElementById("currentPassword").value;

    if (!password) return alert("ุฃุฏุฎู ูููุฉ ุงูุณุฑ ูุชุฃููุฏ ุงูุญุฐู.");

    const credential = EmailAuthProvider.credential(user.email, password);

    reauthenticateWithCredential(user, credential).then(() => {
      return deleteUser(user);
    }).then(() => {
      alert("โ ุชู ุญุฐู ุงูุญุณุงุจ ุจูุฌุงุญ.");
      window.location.href = "login.html";
    }).catch((error) => {
      statusMsg.textContent = "โ ูุดู ุญุฐู ุงูุญุณุงุจ: " + error.message;
    });
  };
</script>

</body>
</html>
